<%= form_with model: audio_file, local: false, data: { controller: "upload", turbo_frame: "upload_form" },
               class: "space-y-4", multipart: true do |form| %>

  <% if audio_file.errors.any? %>
    <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg">
      <h4 class="font-medium">Please fix the following errors:</h4>
      <ul class="mt-2 list-disc list-inside text-sm">
        <% audio_file.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- File Upload Area -->
    <div class="md:col-span-2">
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors"
           data-controller="drag-drop"
           data-upload-target="dropZone"
           data-action="dragover->drag-drop#dragover dragleave->drag-drop#dragleave drop->drag-drop#drop">

        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>

        <div class="mb-4">
          <p class="text-lg font-medium text-gray-900 mb-2">Drop your audio file here</p>
          <p class="text-sm text-gray-500">or click to browse</p>
        </div>

        <%= form.file_field :original_file,
                           class: "hidden",
                           accept: "audio/*",
                           data: {
                             upload_target: "fileInput",
                             action: "change->upload#fileSelected"
                           } %>

        <button type="button"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                data-action="click->upload#browse">
          Choose File
        </button>

        <div data-upload-target="fileName" class="mt-4 text-sm text-gray-600 hidden"></div>
      </div>
    </div>

    <!-- Title Field -->
    <div>
      <%= form.label :title, class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_field :title,
                         class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                         placeholder: "Enter a title for your audio file" %>
    </div>

    <!-- Submit Button -->
    <div class="flex items-end">
      <%= form.submit "Upload & Process",
                     class: "w-full bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",
                     data: { upload_target: "submitButton" },
                     disabled: true %>
    </div>
  </div>

  <!-- Upload Progress -->
  <div data-upload-target="progress" class="hidden">
    <div class="bg-gray-200 rounded-full h-2">
      <div data-upload-target="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
    </div>
    <p data-upload-target="progressText" class="text-sm text-gray-600 mt-2">Uploading...</p>
  </div>
<% end %>