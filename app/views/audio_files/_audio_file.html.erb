<%= turbo_frame_tag audio_file do %>
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden transition-colors">

    <!-- Header: File Info -->
    <div class="px-6 py-5 border-b border-gray-100 dark:border-gray-700">
      <div class="flex items-start justify-between">
        <div class="flex items-center gap-4">
          <!-- Status Icon -->
          <div class="flex-shrink-0">
            <% case audio_file.status %>
            <% when "uploaded" %>
              <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                </svg>
              </div>
            <% when "processing" %>
              <div class="w-12 h-12 bg-amber-100 dark:bg-amber-900/50 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-amber-600 dark:text-amber-400 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </div>
            <% when "completed" %>
              <div class="w-12 h-12 bg-emerald-100 dark:bg-emerald-900/50 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-emerald-600 dark:text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
              </div>
            <% when "failed" %>
              <div class="w-12 h-12 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </div>
            <% end %>
          </div>

          <!-- File Details -->
          <div>
            <h1 class="text-xl font-semibold text-gray-900 dark:text-white" title="<%= audio_file.title %>">
              <%= audio_file.title %>
            </h1>
            <div class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500 dark:text-gray-400 mt-1">
              <span class="flex items-center">
                <svg class="w-4 h-4 mr-1.5 text-gray-400 dark:text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
                </svg>
                <%= number_to_human_size(audio_file.file_size) %>
              </span>
              <span class="flex items-center">
                <svg class="w-4 h-4 mr-1.5 text-gray-400 dark:text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
                <%= time_duration_format(audio_file.duration) %>
              </span>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                          <%= case audio_file.status
                              when 'uploaded' then 'bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300'
                              when 'processing' then 'bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300'
                              when 'completed' then 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300'
                              when 'failed' then 'bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300'
                              end %>">
                <%= audio_file.status.humanize %>
              </span>
            </div>
          </div>
        </div>

        <!-- Delete Button -->
        <%= link_to audio_file,
                    method: :delete,
                    data: {
                      confirm: "Are you sure you want to delete this audio file?",
                      turbo_method: :delete
                    },
                    class: "p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",
                    title: "Delete file" do %>
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
          </svg>
        <% end %>
      </div>

      <!-- Processing Progress -->
      <% if audio_file.processing? && audio_file.separation_jobs.any? %>
        <% latest_job = audio_file.separation_jobs.first %>
        <div class="mt-4" id="separation_job_<%= latest_job.id %>">
          <%= render "separation_jobs/progress", separation_job: latest_job %>
        </div>
      <% end %>

      <!-- Retry button for failed files -->
      <% if audio_file.failed? %>
        <div class="mt-4">
          <%= button_to retry_audio_file_path(audio_file),
                        method: :post,
                        class: "inline-flex items-center px-4 py-2 border border-blue-300 dark:border-blue-600 shadow-sm text-sm font-medium rounded-lg text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors" do %>
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
            </svg>
            Retry Separation
          <% end %>
        </div>
      <% end %>
    </div>

    <% if audio_file.completed? %>
      <div data-controller="stem-mixer"
           data-stem-mixer-audio-file-id-value="<%= audio_file.id %>"
           data-stem-mixer-mix-url-value="<%= mix_audio_file_path(audio_file) %>">

        <!-- Stem Mixer Section -->
        <div class="px-6 py-5 border-b border-gray-100 dark:border-gray-700">
          <h2 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Stem Mixer</h2>

          <div class="space-y-3">
            <!-- Original Track Row -->
            <div class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
              <div class="w-8 flex justify-center">
                <span class="text-xs text-gray-400 dark:text-gray-500">-</span>
              </div>
              <div class="flex-1 min-w-0">
                <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Original</span>
              </div>
              <button type="button"
                      data-controller="audio-player"
                      data-action="click->audio-player#loadTrack"
                      data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'original') %>"
                      data-audio-player-name-param="Original"
                      data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                      class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 hover:bg-gray-50 dark:hover:bg-gray-500 hover:border-gray-400 dark:hover:border-gray-400 transition-colors shadow-sm">
                <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                </svg>
                Play
              </button>
            </div>

            <!-- Vocals Row -->
            <% if audio_file.vocals_stem.attached? %>
              <div class="flex items-center gap-3 p-3 bg-purple-50/50 dark:bg-purple-900/20 rounded-lg border border-purple-100 dark:border-purple-800/50">
                <div class="w-8 flex justify-center">
                  <input type="checkbox" value="vocals"
                         data-stem-mixer-target="checkbox"
                         data-stem-url="<%= stems_audio_file_path(audio_file, stem_type: 'vocals') %>"
                         data-action="change->stem-mixer#toggleStem"
                         class="w-5 h-5 text-purple-600 dark:text-purple-500 border-gray-300 dark:border-gray-600 rounded focus:ring-purple-500 cursor-pointer bg-white dark:bg-gray-700">
                </div>
                <div class="w-20">
                  <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Vocals</span>
                </div>
                <div class="flex-1 flex items-center gap-3">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                  <input type="range" min="0" max="1" step="0.01" value="1"
                         data-stem-mixer-target="slider"
                         data-stem-type="vocals"
                         data-action="input->stem-mixer#updateVolume"
                         class="flex-1 h-2 bg-purple-200 dark:bg-purple-900/50 rounded-lg appearance-none cursor-pointer accent-purple-600 dark:accent-purple-500">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"/>
                  </svg>
                  <span data-stem-mixer-target="volumeLabel" data-stem-type="vocals" class="w-12 text-xs text-gray-500 dark:text-gray-400 text-right">100%</span>
                </div>
                <button type="button"
                        data-controller="audio-player"
                        data-action="click->audio-player#loadTrack"
                        data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'vocals') %>"
                        data-audio-player-name-param="Vocals"
                        data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                        class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-purple-700 dark:text-purple-300 bg-white dark:bg-purple-900/30 border border-purple-200 dark:border-purple-700 hover:bg-purple-50 dark:hover:bg-purple-900/50 hover:border-purple-300 dark:hover:border-purple-600 transition-colors shadow-sm">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                  </svg>
                  Play
                </button>
              </div>
            <% end %>

            <!-- Drums Row -->
            <% if audio_file.drums_stem.attached? %>
              <div class="flex items-center gap-3 p-3 bg-orange-50/50 dark:bg-orange-900/20 rounded-lg border border-orange-100 dark:border-orange-800/50">
                <div class="w-8 flex justify-center">
                  <input type="checkbox" value="drums"
                         data-stem-mixer-target="checkbox"
                         data-stem-url="<%= stems_audio_file_path(audio_file, stem_type: 'drums') %>"
                         data-action="change->stem-mixer#toggleStem"
                         class="w-5 h-5 text-orange-600 dark:text-orange-500 border-gray-300 dark:border-gray-600 rounded focus:ring-orange-500 cursor-pointer bg-white dark:bg-gray-700">
                </div>
                <div class="w-20">
                  <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Drums</span>
                </div>
                <div class="flex-1 flex items-center gap-3">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                  <input type="range" min="0" max="1" step="0.01" value="1"
                         data-stem-mixer-target="slider"
                         data-stem-type="drums"
                         data-action="input->stem-mixer#updateVolume"
                         class="flex-1 h-2 bg-orange-200 dark:bg-orange-900/50 rounded-lg appearance-none cursor-pointer accent-orange-600 dark:accent-orange-500">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"/>
                  </svg>
                  <span data-stem-mixer-target="volumeLabel" data-stem-type="drums" class="w-12 text-xs text-gray-500 dark:text-gray-400 text-right">100%</span>
                </div>
                <button type="button"
                        data-controller="audio-player"
                        data-action="click->audio-player#loadTrack"
                        data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'drums') %>"
                        data-audio-player-name-param="Drums"
                        data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                        class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-orange-700 dark:text-orange-300 bg-white dark:bg-orange-900/30 border border-orange-200 dark:border-orange-700 hover:bg-orange-50 dark:hover:bg-orange-900/50 hover:border-orange-300 dark:hover:border-orange-600 transition-colors shadow-sm">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                  </svg>
                  Play
                </button>
              </div>
            <% end %>

            <!-- Bass Row -->
            <% if audio_file.bass_stem.attached? %>
              <div class="flex items-center gap-3 p-3 bg-blue-50/50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800/50">
                <div class="w-8 flex justify-center">
                  <input type="checkbox" value="bass"
                         data-stem-mixer-target="checkbox"
                         data-stem-url="<%= stems_audio_file_path(audio_file, stem_type: 'bass') %>"
                         data-action="change->stem-mixer#toggleStem"
                         class="w-5 h-5 text-blue-600 dark:text-blue-500 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 cursor-pointer bg-white dark:bg-gray-700">
                </div>
                <div class="w-20">
                  <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Bass</span>
                </div>
                <div class="flex-1 flex items-center gap-3">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                  <input type="range" min="0" max="1" step="0.01" value="1"
                         data-stem-mixer-target="slider"
                         data-stem-type="bass"
                         data-action="input->stem-mixer#updateVolume"
                         class="flex-1 h-2 bg-blue-200 dark:bg-blue-900/50 rounded-lg appearance-none cursor-pointer accent-blue-600 dark:accent-blue-500">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"/>
                  </svg>
                  <span data-stem-mixer-target="volumeLabel" data-stem-type="bass" class="w-12 text-xs text-gray-500 dark:text-gray-400 text-right">100%</span>
                </div>
                <button type="button"
                        data-controller="audio-player"
                        data-action="click->audio-player#loadTrack"
                        data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'bass') %>"
                        data-audio-player-name-param="Bass"
                        data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                        class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-blue-700 dark:text-blue-300 bg-white dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 hover:bg-blue-50 dark:hover:bg-blue-900/50 hover:border-blue-300 dark:hover:border-blue-600 transition-colors shadow-sm">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                  </svg>
                  Play
                </button>
              </div>
            <% end %>

            <!-- Other Row -->
            <% if audio_file.other_stem.attached? %>
              <div class="flex items-center gap-3 p-3 bg-emerald-50/50 dark:bg-emerald-900/20 rounded-lg border border-emerald-100 dark:border-emerald-800/50">
                <div class="w-8 flex justify-center">
                  <input type="checkbox" value="other"
                         data-stem-mixer-target="checkbox"
                         data-stem-url="<%= stems_audio_file_path(audio_file, stem_type: 'other') %>"
                         data-action="change->stem-mixer#toggleStem"
                         class="w-5 h-5 text-emerald-600 dark:text-emerald-500 border-gray-300 dark:border-gray-600 rounded focus:ring-emerald-500 cursor-pointer bg-white dark:bg-gray-700">
                </div>
                <div class="w-20">
                  <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Other</span>
                </div>
                <div class="flex-1 flex items-center gap-3">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                  <input type="range" min="0" max="1" step="0.01" value="1"
                         data-stem-mixer-target="slider"
                         data-stem-type="other"
                         data-action="input->stem-mixer#updateVolume"
                         class="flex-1 h-2 bg-emerald-200 dark:bg-emerald-900/50 rounded-lg appearance-none cursor-pointer accent-emerald-600 dark:accent-emerald-500">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"/>
                  </svg>
                  <span data-stem-mixer-target="volumeLabel" data-stem-type="other" class="w-12 text-xs text-gray-500 dark:text-gray-400 text-right">100%</span>
                </div>
                <button type="button"
                        data-controller="audio-player"
                        data-action="click->audio-player#loadTrack"
                        data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'other') %>"
                        data-audio-player-name-param="Other"
                        data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                        class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md text-emerald-700 dark:text-emerald-300 bg-white dark:bg-emerald-900/30 border border-emerald-200 dark:border-emerald-700 hover:bg-emerald-50 dark:hover:bg-emerald-900/50 hover:border-emerald-300 dark:hover:border-emerald-600 transition-colors shadow-sm">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                  </svg>
                  Play
                </button>
              </div>
            <% end %>
          </div>

          <!-- Mix Controls (hidden until 2+ stems selected) -->
          <div data-stem-mixer-target="mixControls" class="hidden mt-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/30 dark:to-purple-900/30 rounded-lg border border-indigo-200 dark:border-indigo-700">
            <div class="flex items-center justify-between flex-wrap gap-3">
              <span class="text-sm font-medium text-indigo-900 dark:text-indigo-200">Custom Mix</span>
              <div class="flex items-center gap-2">
                <button type="button"
                        data-action="click->stem-mixer#playMix"
                        class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-400 transition-colors shadow-sm">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                  </svg>
                  Play Mix
                </button>
                <button type="button"
                        data-action="click->stem-mixer#downloadMix"
                        class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg text-indigo-700 dark:text-indigo-200 bg-white dark:bg-indigo-900/50 border border-indigo-300 dark:border-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-900/70 transition-colors shadow-sm">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                  Download Mix
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Audio Player Section -->
        <div id="player_container_<%= audio_file.id %>" class="hidden px-6 py-5 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50" data-controller="waveform-player">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Now Playing:</span>
              <span id="track_name_<%= audio_file.id %>" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400"></span>
            </div>
            <div class="flex items-center gap-2">
              <button type="button" data-waveform-player-target="playPauseBtn" data-action="click->waveform-player#togglePlayPause"
                      class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-indigo-600 dark:bg-indigo-500 text-white hover:bg-indigo-700 dark:hover:bg-indigo-400 transition-colors shadow-md">
                <svg data-waveform-player-target="playIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                </svg>
                <svg data-waveform-player-target="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </button>
              <button type="button" data-action="click->waveform-player#stop"
                      class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>
          <audio id="audio_player_<%= audio_file.id %>"></audio>
        </div>

        <!-- Downloads Section -->
        <div class="px-6 py-5">
          <h2 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Download Stems</h2>

          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3">
            <% if audio_file.vocals_stem.attached? %>
              <%= link_to download_audio_file_path(audio_file, stem_type: "vocals"),
                         class: "flex flex-col items-center p-4 bg-purple-50 dark:bg-purple-900/30 rounded-lg border border-purple-200 dark:border-purple-700 hover:bg-purple-100 dark:hover:bg-purple-900/50 hover:border-purple-300 dark:hover:border-purple-600 transition-colors group",
                         data: { turbo: false } do %>
                <svg class="w-8 h-8 text-purple-400 dark:text-purple-500 group-hover:text-purple-600 dark:group-hover:text-purple-400 mb-2 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
                <span class="text-sm font-medium text-purple-700 dark:text-purple-300">Vocals</span>
              <% end %>
            <% end %>

            <% if audio_file.drums_stem.attached? %>
              <%= link_to download_audio_file_path(audio_file, stem_type: "drums"),
                         class: "flex flex-col items-center p-4 bg-orange-50 dark:bg-orange-900/30 rounded-lg border border-orange-200 dark:border-orange-700 hover:bg-orange-100 dark:hover:bg-orange-900/50 hover:border-orange-300 dark:hover:border-orange-600 transition-colors group",
                         data: { turbo: false } do %>
                <svg class="w-8 h-8 text-orange-400 dark:text-orange-500 group-hover:text-orange-600 dark:group-hover:text-orange-400 mb-2 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
                <span class="text-sm font-medium text-orange-700 dark:text-orange-300">Drums</span>
              <% end %>
            <% end %>

            <% if audio_file.bass_stem.attached? %>
              <%= link_to download_audio_file_path(audio_file, stem_type: "bass"),
                         class: "flex flex-col items-center p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/50 hover:border-blue-300 dark:hover:border-blue-600 transition-colors group",
                         data: { turbo: false } do %>
                <svg class="w-8 h-8 text-blue-400 dark:text-blue-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 mb-2 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
                <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Bass</span>
              <% end %>
            <% end %>

            <% if audio_file.other_stem.attached? %>
              <%= link_to download_audio_file_path(audio_file, stem_type: "other"),
                         class: "flex flex-col items-center p-4 bg-emerald-50 dark:bg-emerald-900/30 rounded-lg border border-emerald-200 dark:border-emerald-700 hover:bg-emerald-100 dark:hover:bg-emerald-900/50 hover:border-emerald-300 dark:hover:border-emerald-600 transition-colors group",
                         data: { turbo: false } do %>
                <svg class="w-8 h-8 text-emerald-400 dark:text-emerald-500 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 mb-2 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
                <span class="text-sm font-medium text-emerald-700 dark:text-emerald-300">Other</span>
              <% end %>
            <% end %>

            <%= link_to download_audio_file_path(audio_file, stem_type: "original"),
                       class: "flex flex-col items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 hover:border-gray-300 dark:hover:border-gray-500 transition-colors group",
                       data: { turbo: false } do %>
              <svg class="w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-400 mb-2 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Original</span>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

  </div>
<% end %>
