<%= turbo_frame_tag audio_file do %>
  <div class="p-6 hover:bg-gray-50 transition-colors">
    <div class="flex items-center justify-between">
      <!-- File Info -->
      <div class="flex-1">
        <div class="flex items-center space-x-4">
          <!-- Status Icon -->
          <div class="flex-shrink-0">
            <% case audio_file.status %>
            <% when "uploaded" %>
              <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                </svg>
              </div>
            <% when "processing" %>
              <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-yellow-600 animate-spin" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 000 1.788l4 2z"/>
                  <path d="M15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z"/>
                </svg>
              </div>
            <% when "completed" %>
              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
              </div>
            <% when "failed" %>
              <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              </div>
            <% end %>
          </div>

          <!-- File Details -->
          <div class="flex-1 min-w-0">
            <h3 class="text-lg font-medium text-gray-900 truncate">
              <%= link_to audio_file.title, audio_file, class: "hover:text-blue-600 transition-colors", data: { turbo_frame: "_top" } %>
            </h3>
            <div class="flex items-center space-x-4 text-sm text-gray-500 mt-1">
              <span class="flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
                </svg>
                <%= number_to_human_size(audio_file.file_size) %>
              </span>
              <span class="flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
                <%= time_duration_format(audio_file.duration) %>
              </span>
              <span class="capitalize">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                             <%= case audio_file.status
                                 when 'uploaded' then 'bg-blue-100 text-blue-800'
                                 when 'processing' then 'bg-yellow-100 text-yellow-800'
                                 when 'completed' then 'bg-green-100 text-green-800'
                                 when 'failed' then 'bg-red-100 text-red-800'
                                 end %>">
                  <%= audio_file.status.humanize %>
                </span>
              </span>
            </div>
          </div>
        </div>

        <!-- Processing Progress -->
        <% if audio_file.processing? && audio_file.separation_jobs.any? %>
          <% latest_job = audio_file.separation_jobs.first %>
          <div class="mt-4" id="separation_job_<%= latest_job.id %>">
            <%= render "separation_jobs/progress", separation_job: latest_job %>
          </div>
        <% end %>
      </div>

      <!-- Actions -->
      <div class="flex items-start space-x-2 ml-4">
        <% if audio_file.completed? %>
          <div class="flex flex-col space-y-3">
            <!-- Preview buttons and download button in same row -->
            <div class="flex items-center space-x-2">
              <!-- Preview buttons -->
              <button type="button"
                      data-controller="audio-player"
                      data-action="click->audio-player#loadTrack"
                      data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'original') %>"
                      data-audio-player-name-param="Original"
                      data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                      class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-blue-50 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                </svg>
                Original
              </button>

              <% if audio_file.vocals_stem.attached? %>
                <button type="button"
                        data-controller="audio-player"
                        data-action="click->audio-player#loadTrack"
                        data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'vocals') %>"
                        data-audio-player-name-param="Vocals"
                        data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                        class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-blue-50 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                  </svg>
                  Vocals
                </button>
              <% end %>

              <% if audio_file.accompaniment_stem.attached? %>
                <button type="button"
                        data-controller="audio-player"
                        data-action="click->audio-player#loadTrack"
                        data-audio-player-url-param="<%= stems_audio_file_path(audio_file, stem_type: 'accompaniment') %>"
                        data-audio-player-name-param="Music"
                        data-audio-player-player-container-value="#player_container_<%= audio_file.id %>"
                        class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-blue-50 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                  </svg>
                  Music
                </button>
              <% end %>

              <!-- Download dropdown -->
              <div class="relative" data-controller="dropdown">
                <button data-action="click->dropdown#toggle"
                        class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                  Download
                  <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                </button>

                <div data-dropdown-target="menu"
                     class="hidden absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10">
                  <div class="py-1">
                    <%= link_to download_audio_file_path(audio_file, stem_type: "vocals"),
                               class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",
                               data: { turbo: false } do %>
                      <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
                        </svg>
                        Download Vocals
                      </div>
                    <% end %>

                    <%= link_to download_audio_file_path(audio_file, stem_type: "accompaniment"),
                               class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",
                               data: { turbo: false } do %>
                      <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
                        </svg>
                        Download Music
                      </div>
                    <% end %>

                    <%= link_to download_audio_file_path(audio_file, stem_type: "original"),
                               class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",
                               data: { turbo: false } do %>
                      <div class="flex items-center">
                        <svg class="w-4 h-4 mr-3" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Download Original
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>

            <!-- Single Audio Player (hidden until track is loaded) -->
            <div id="player_container_<%= audio_file.id %>" class="hidden">
              <div class="text-xs font-medium text-gray-700 mb-2">
                Now Playing: <span id="track_name_<%= audio_file.id %>" class="text-blue-600"></span>
              </div>
              <audio id="audio_player_<%= audio_file.id %>"></audio>
            </div>
          </div>
        <% end %>

        <!-- Delete button -->
        <%= link_to audio_file,
                   method: :delete,
                   data: {
                     confirm: "Are you sure you want to delete this audio file?",
                     turbo_method: :delete
                   },
                   class: "inline-flex items-center p-2 border border-transparent rounded-md text-red-600 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" do %>
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
          </svg>
        <% end %>
      </div>
    </div>
  </div>
<% end %>